<!-- LibreChat-Style Chat Interface -->
<div class="chat-container">
  <!-- Messages Area -->
  <div class="messages-area" #messagesContainer>
    <div class="messages-wrapper">
      <!-- Welcome Screen -->
      <div *ngIf="messages.length === 0" class="welcome-screen">
        <h1 class="greeting">{{ getGreeting() }}</h1>
        <p class="tagline">How can I help you with MCP servers today?</p>

        <div class="suggestion-cards">
          <button
            class="suggestion-card"
            (click)="useSuggestion('Generate an MCP server from the Express.js GitHub repository')">
            <mat-icon>code</mat-icon>
            <div class="suggestion-text">
              <div class="suggestion-title">Analyze a GitHub repository</div>
              <div class="suggestion-desc">Generate MCP server from any repo</div>
            </div>
          </button>

          <button
            class="suggestion-card"
            (click)="useSuggestion('Create an MCP server for a REST API based on OpenAPI specification')">
            <mat-icon>api</mat-icon>
            <div class="suggestion-text">
              <div class="suggestion-title">Work with API specs</div>
              <div class="suggestion-desc">OpenAPI, Swagger, GraphQL</div>
            </div>
          </button>

          <button
            class="suggestion-card"
            (click)="useSuggestion('Help me understand what MCP servers are and what they can do')">
            <mat-icon>help_outline</mat-icon>
            <div class="suggestion-text">
              <div class="suggestion-title">Learn about MCP</div>
              <div class="suggestion-desc">Understand Model Context Protocol</div>
            </div>
          </button>
        </div>
      </div>

      <!-- Chat Messages -->
      <div class="messages-list" *ngIf="messages.length > 0">
        <div
          *ngFor="let message of messages; let i = index"
          class="message-wrapper"
          [class.user-message]="message.type === 'user'"
          [class.assistant-message]="message.type === 'assistant'"
          [class.progress-message]="message.type === 'progress'"
          [class.error-message]="message.type === 'error'">

          <!-- Avatar -->
          <div class="message-avatar">
            <div class="avatar-circle" [class.user-avatar]="message.type === 'user'">
              <mat-icon *ngIf="message.type === 'user'">person</mat-icon>
              <mat-icon *ngIf="message.type === 'assistant'">memory</mat-icon>
              <mat-icon *ngIf="message.type === 'progress'" class="spinning">autorenew</mat-icon>
              <mat-icon *ngIf="message.type === 'error'">error</mat-icon>
            </div>
          </div>

          <!-- Message Content -->
          <div class="message-content">
            <div class="message-header">
              <span class="message-sender">{{ message.type === 'user' ? 'You' : 'MCP Everything' }}</span>
            </div>

            <div class="message-body" [innerHTML]="message.content | safeMarkdown"></div>

            <!-- Action Buttons -->
            <div class="message-actions" *ngIf="message.type === 'assistant' && !message.generatedCode">
              <button mat-icon-button matTooltip="Copy" class="action-button">
                <mat-icon>content_copy</mat-icon>
              </button>
              <button mat-icon-button matTooltip="Like" class="action-button">
                <mat-icon>thumb_up</mat-icon>
              </button>
              <button mat-icon-button matTooltip="Dislike" class="action-button">
                <mat-icon>thumb_down</mat-icon>
              </button>
            </div>

            <!-- Deployment Actions (when generatedCode exists and not yet deployed) -->
            <div *ngIf="message.generatedCode && !message.deploymentResult" class="deployment-actions">
              <button mat-raised-button color="primary"
                      (click)="deployToGitHub(message)"
                      [disabled]="isDeploying(message)"
                      class="deploy-button">
                <mat-icon>{{ isDeploying(message) ? 'hourglass_empty' : 'cloud_upload' }}</mat-icon>
                {{ isDeploying(message) ? 'Deploying...' : 'Deploy as Repo' }}
              </button>
              <button mat-raised-button
                      (click)="deployToGist(message)"
                      [disabled]="isDeploying(message)"
                      class="deploy-button gist-button">
                <mat-icon>code</mat-icon>
                Deploy as Gist
              </button>
              <button mat-button
                      (click)="downloadAsZip(message)"
                      class="download-zip-button">
                <mat-icon>download</mat-icon>
                Download ZIP
              </button>
            </div>

            <!-- Deployment Result Card (when deployment succeeded) -->
            <div *ngIf="message.deploymentResult?.success" class="deployment-result-card">
              <div class="result-header">
                <mat-icon class="success-icon">check_circle</mat-icon>
                <span>MCP Server Deployed Successfully!</span>
              </div>

              <!-- Repository deployment result -->
              <ng-container *ngIf="message.deploymentResult?.type === 'repo'">
                <div class="deployment-url">
                  <a [href]="message.deploymentResult?.urls?.repository" target="_blank" rel="noopener">
                    {{ message.deploymentResult?.urls?.repository }}
                  </a>
                </div>

                <div class="deployment-buttons">
                  <a mat-raised-button color="primary"
                     [href]="message.deploymentResult?.urls?.codespace"
                     target="_blank" rel="noopener"
                     class="action-link">
                    <mat-icon>rocket_launch</mat-icon>
                    Open in Codespace
                  </a>
                  <a mat-raised-button
                     [href]="message.deploymentResult?.urls?.repository"
                     target="_blank" rel="noopener"
                     class="action-link">
                    <mat-icon>visibility</mat-icon>
                    View on GitHub
                  </a>
                </div>

                <div class="clone-command" *ngIf="message.deploymentResult?.urls?.clone">
                  <code>git clone {{ message.deploymentResult?.urls?.clone }}</code>
                  <button mat-icon-button
                          (click)="copyToClipboard('git clone ' + message.deploymentResult?.urls?.clone)"
                          matTooltip="Copy clone command">
                    <mat-icon>content_copy</mat-icon>
                  </button>
                </div>
              </ng-container>

              <!-- Gist deployment result -->
              <ng-container *ngIf="message.deploymentResult?.type === 'gist'">
                <div class="deployment-url">
                  <a [href]="message.deploymentResult?.urls?.gist" target="_blank" rel="noopener">
                    {{ message.deploymentResult?.urls?.gist }}
                  </a>
                </div>

                <div class="deployment-buttons">
                  <a mat-raised-button color="primary"
                     [href]="message.deploymentResult?.urls?.gist"
                     target="_blank" rel="noopener"
                     class="action-link">
                    <mat-icon>visibility</mat-icon>
                    View Gist
                  </a>
                </div>
              </ng-container>
            </div>

            <!-- Deployment Error Card -->
            <div *ngIf="message.deploymentResult?.success === false" class="deployment-error-card">
              <div class="error-header">
                <mat-icon class="error-icon">error</mat-icon>
                <span>Deployment Failed</span>
              </div>
              <p class="error-message">{{ message.deploymentResult?.error }}</p>
              <div class="error-actions">
                <button mat-button (click)="deployToGitHub(message)" class="retry-button">
                  <mat-icon>refresh</mat-icon>
                  Retry as Repo
                </button>
                <button mat-button (click)="deployToGist(message)" class="retry-button">
                  <mat-icon>refresh</mat-icon>
                  Retry as Gist
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Deployment Links -->
        <div *ngIf="latestDeployment?.status === 'success'" class="deployment-links">
          <div class="deployment-header">
            <mat-icon>cloud_done</mat-icon>
            <span>Your MCP Server is deployed!</span>
          </div>
          <div class="deployment-actions">
            <a
              *ngIf="latestDeployment?.repositoryUrl"
              [href]="latestDeployment?.repositoryUrl"
              target="_blank"
              rel="noopener noreferrer"
              mat-raised-button
              color="primary"
              class="deployment-link">
              <mat-icon>code</mat-icon>
              View on GitHub
            </a>
            <a
              *ngIf="latestDeployment?.gistUrl"
              [href]="latestDeployment?.gistUrl"
              target="_blank"
              rel="noopener noreferrer"
              mat-raised-button
              class="deployment-link">
              <mat-icon>description</mat-icon>
              View Gist
            </a>
            <a
              *ngIf="latestDeployment?.codespaceUrl"
              [href]="latestDeployment?.codespaceUrl"
              target="_blank"
              rel="noopener noreferrer"
              mat-raised-button
              color="accent"
              class="deployment-link">
              <mat-icon>cloud</mat-icon>
              Open in Codespace
            </a>
          </div>
        </div>

        <!-- Deployment Error -->
        <div *ngIf="latestDeployment?.status === 'failed'" class="deployment-error">
          <div class="deployment-header">
            <mat-icon>error_outline</mat-icon>
            <span>Deployment failed</span>
          </div>
          <p class="error-message">{{ latestDeployment?.errorMessage }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="input-area">
    <div class="input-container">
      <div class="input-wrapper">
        <!-- Attachment Button -->
        <button
          mat-icon-button
          class="input-icon-button"
          matTooltip="Attach file">
          <mat-icon>attach_file</mat-icon>
        </button>

        <!-- Text Input -->
        <textarea
          #messageInput
          class="message-input"
          [(ngModel)]="currentMessage"
          (keydown)="onKeyPress($event)"
          [disabled]="isLoading"
          rows="1"
          placeholder="Message MCP Everything..."
          (input)="autoResize($event)">
        </textarea>

        <!-- Send Button -->
        <button
          mat-icon-button
          class="send-button"
          [disabled]="!currentMessage.trim() || isLoading"
          (click)="sendMessage()"
          aria-label="Send message">
          <mat-icon>{{ isLoading ? 'stop_circle' : 'send' }}</mat-icon>
        </button>
      </div>

      <!-- Info Text -->
      <div class="input-info">
        MCP Everything can make mistakes. Check important info.
      </div>
    </div>
  </div>
</div>