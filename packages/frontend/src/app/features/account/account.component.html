<!-- LibreChat-Style Account Page -->
<div class="account-container">
  <div class="account-content">
    <!-- Page Header -->
    <div class="page-header">
      <h1>Account Settings</h1>
      <p class="subtitle">Manage your profile, preferences, and account information</p>
    </div>

    <!-- Profile Section -->
    <div class="settings-section">
      <div class="section-header">
        <div class="section-icon">
          <mat-icon>person</mat-icon>
        </div>
        <div class="section-title">
          <h2>Profile Information</h2>
          <p>Update your personal details and contact information</p>
        </div>
      </div>

      <div class="section-content">
        <div class="profile-layout">
          <div class="profile-avatar-section">
            <div class="avatar-circle">
              <mat-icon>account_circle</mat-icon>
            </div>
            <button class="text-button" disabled>
              <span>Change Photo</span>
            </button>
          </div>

          <div class="profile-fields">
            <div class="form-group">
              <label class="form-label">Full Name</label>
              <input
                type="text"
                class="form-input"
                [(ngModel)]="profile.name"
                [disabled]="!isEditingProfile"
                placeholder="Enter your full name">
            </div>

            <div class="form-group">
              <label class="form-label">Email Address</label>
              <input
                type="email"
                class="form-input"
                [(ngModel)]="profile.email"
                [disabled]="!isEditingProfile"
                placeholder="Enter your email">
            </div>

            <div class="form-actions">
              <button
                *ngIf="!isEditingProfile"
                class="action-button primary"
                (click)="editProfile()">
                <mat-icon>edit</mat-icon>
                <span>Edit Profile</span>
              </button>
              <button
                *ngIf="isEditingProfile"
                class="action-button primary"
                (click)="saveProfile()">
                <mat-icon>check</mat-icon>
                <span>Save Changes</span>
              </button>
              <button
                *ngIf="isEditingProfile"
                class="action-button secondary"
                (click)="cancelEdit()">
                <span>Cancel</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- API Key Section -->
    <div class="settings-section">
      <div class="section-header">
        <div class="section-icon">
          <mat-icon>vpn_key</mat-icon>
        </div>
        <div class="section-title">
          <h2>API Key</h2>
          <p>Use this key for programmatic access to your account</p>
        </div>
      </div>

      <div class="section-content">
        <div class="api-key-container">
          <div class="form-group">
            <label class="form-label">Your API Key</label>
            <div class="input-with-button">
              <input
                type="text"
                class="form-input"
                [value]="profile.apiKey"
                readonly>
              <button
                class="icon-button"
                (click)="copyApiKey()"
                matTooltip="Copy to clipboard">
                <mat-icon>content_copy</mat-icon>
              </button>
            </div>
          </div>

          <div class="warning-banner">
            <mat-icon>warning</mat-icon>
            <span>Keep your API key secure. Never share it publicly or commit it to version control.</span>
          </div>

          <div class="form-actions">
            <button
              class="action-button danger"
              (click)="regenerateApiKey()">
              <mat-icon>refresh</mat-icon>
              <span>Regenerate Key</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Usage Statistics -->
    <div class="settings-section">
      <div class="section-header">
        <div class="section-icon">
          <mat-icon>bar_chart</mat-icon>
        </div>
        <div class="section-title">
          <h2>Usage Statistics</h2>
          <p>Track your account activity and resource usage</p>
        </div>
      </div>

      <div class="section-content">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <mat-icon>memory</mat-icon>
            </div>
            <div class="stat-details">
              <div class="stat-value">{{ profile.serversGenerated }}</div>
              <div class="stat-label">Servers Generated</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <mat-icon>storage</mat-icon>
            </div>
            <div class="stat-details">
              <div class="stat-value">{{ profile.storageUsed }}</div>
              <div class="stat-label">Storage Used</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Subscription & Tier Section -->
    <div class="settings-section" *ngIf="tierInfo$ | async as tierInfo">
      <div class="section-header">
        <div class="section-icon">
          <mat-icon>workspace_premium</mat-icon>
        </div>
        <div class="section-title">
          <h2>Subscription</h2>
          <p>Manage your plan and billing</p>
        </div>
      </div>

      <div class="section-content">
        <!-- Current Plan Display -->
        <div class="current-plan-card">
          <div class="plan-header">
            <span class="plan-badge" [ngClass]="tierInfo.currentTier">
              {{ getTierDisplayName(tierInfo.currentTier) }} Plan
            </span>
            <span class="plan-status" *ngIf="(subscription$ | async) as sub">
              {{ sub.status === 'active' ? 'Active' : (sub.status | titlecase) }}
            </span>
          </div>

          <!-- Usage Progress (Free tier only) -->
          <div class="usage-progress" *ngIf="tierInfo.currentTier === 'free'">
            <div class="usage-header">
              <span>Servers deployed this month</span>
              <span class="usage-count">
                {{ tierInfo.usage.serversDeployed }} / {{ tierInfo.usage.limit }}
              </span>
            </div>
            <div class="progress-bar-container">
              <div
                class="progress-bar-fill"
                [style.width.%]="(tierInfo.usage.serversDeployed / tierInfo.usage.limit) * 100"
                [class.warning]="tierInfo.usage.serversDeployed >= tierInfo.usage.limit * 0.8"
                [class.critical]="tierInfo.usage.serversDeployed >= tierInfo.usage.limit">
              </div>
            </div>
            <div class="usage-reset-info">
              Resets on {{ tierInfo.usage.periodEnd | date:'mediumDate' }}
            </div>
          </div>

          <!-- Plan Features -->
          <div class="plan-features">
            <div class="feature-item" [class.enabled]="true">
              <mat-icon>check_circle</mat-icon>
              <span>{{ isUnlimited(tierInfo.limits.monthlyServerLimit) ? 'Unlimited' : tierInfo.limits.monthlyServerLimit }} servers/month</span>
            </div>
            <div class="feature-item" [class.enabled]="tierInfo.limits.privateRepos">
              <mat-icon>{{ tierInfo.limits.privateRepos ? 'check_circle' : 'cancel' }}</mat-icon>
              <span>Private repositories</span>
            </div>
            <div class="feature-item" [class.enabled]="tierInfo.limits.ciCd">
              <mat-icon>{{ tierInfo.limits.ciCd ? 'check_circle' : 'cancel' }}</mat-icon>
              <span>CI/CD pipelines</span>
            </div>
            <div class="feature-item" [class.enabled]="tierInfo.limits.customDomains">
              <mat-icon>{{ tierInfo.limits.customDomains ? 'check_circle' : 'cancel' }}</mat-icon>
              <span>Custom domains</span>
            </div>
          </div>
        </div>

        <!-- Upgrade CTA (Free tier) -->
        <div class="upgrade-section" *ngIf="tierInfo.currentTier === 'free'">
          <!-- Billing Interval Toggle -->
          <div class="billing-toggle">
            <button
              class="interval-btn"
              [class.active]="selectedBillingInterval === 'monthly'"
              (click)="selectBillingInterval('monthly')">
              Monthly
            </button>
            <button
              class="interval-btn"
              [class.active]="selectedBillingInterval === 'yearly'"
              (click)="selectBillingInterval('yearly')">
              Yearly
              <span class="save-badge">Save 17%</span>
            </button>
          </div>

          <div class="pricing-cards">
            <!-- Pro Plan -->
            <div class="upgrade-card pro">
              <div class="upgrade-header">
                <mat-icon>rocket_launch</mat-icon>
                <h3>Pro</h3>
              </div>
              <p class="upgrade-description">
                Unlock unlimited MCP server generation, private repositories, and CI/CD automation.
              </p>
              <ul class="upgrade-benefits">
                <li><mat-icon>check</mat-icon> Unlimited MCP servers</li>
                <li><mat-icon>check</mat-icon> Private GitHub repositories</li>
                <li><mat-icon>check</mat-icon> Automated CI/CD pipelines</li>
                <li><mat-icon>check</mat-icon> Priority support</li>
              </ul>
              <div class="upgrade-price">
                <span class="price">{{ selectedBillingInterval === 'yearly' ? '$290' : '$29' }}</span>
                <span class="period">{{ selectedBillingInterval === 'yearly' ? '/year' : '/month' }}</span>
              </div>
              <button
                class="action-button primary upgrade-button"
                (click)="upgradeToPro()"
                [disabled]="isUpgrading">
                <mat-icon *ngIf="!isUpgrading">upgrade</mat-icon>
                <mat-icon *ngIf="isUpgrading" class="spinning">sync</mat-icon>
                <span>{{ isUpgrading ? 'Loading...' : 'Upgrade to Pro' }}</span>
              </button>
            </div>

            <!-- Enterprise Plan -->
            <div class="upgrade-card enterprise">
              <div class="upgrade-header">
                <mat-icon>business</mat-icon>
                <h3>Enterprise</h3>
                <span class="popular-badge">Contact Us</span>
              </div>
              <p class="upgrade-description">
                Everything in Pro plus custom domains, team features, SSO, and dedicated support.
              </p>
              <ul class="upgrade-benefits">
                <li><mat-icon>check</mat-icon> Everything in Pro</li>
                <li><mat-icon>check</mat-icon> Custom domains</li>
                <li><mat-icon>check</mat-icon> Team collaboration</li>
                <li><mat-icon>check</mat-icon> SSO integration</li>
                <li><mat-icon>check</mat-icon> SLA guarantee</li>
              </ul>
              <div class="upgrade-price">
                <span class="price">$99</span>
                <span class="period">/month</span>
              </div>
              <button
                class="action-button primary upgrade-button enterprise-btn"
                (click)="upgradeToEnterprise()"
                [disabled]="isUpgrading">
                <mat-icon *ngIf="!isUpgrading">upgrade</mat-icon>
                <mat-icon *ngIf="isUpgrading" class="spinning">sync</mat-icon>
                <span>{{ isUpgrading ? 'Loading...' : 'Upgrade to Enterprise' }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Upgrade from Pro to Enterprise -->
        <div class="upgrade-section" *ngIf="tierInfo.currentTier === 'pro'">
          <div class="upgrade-card enterprise solo">
            <div class="upgrade-header">
              <mat-icon>business</mat-icon>
              <h3>Upgrade to Enterprise</h3>
            </div>
            <p class="upgrade-description">
              Get custom domains, team features, SSO integration, and dedicated support.
            </p>
            <ul class="upgrade-benefits">
              <li><mat-icon>check</mat-icon> Everything in Pro</li>
              <li><mat-icon>check</mat-icon> Custom domains</li>
              <li><mat-icon>check</mat-icon> Team collaboration</li>
              <li><mat-icon>check</mat-icon> SSO integration</li>
              <li><mat-icon>check</mat-icon> SLA guarantee</li>
            </ul>
            <div class="upgrade-price">
              <span class="price">$99</span>
              <span class="period">/month</span>
            </div>
            <button
              class="action-button primary upgrade-button enterprise-btn"
              (click)="upgradeToEnterprise()"
              [disabled]="isUpgrading">
              <mat-icon *ngIf="!isUpgrading">upgrade</mat-icon>
              <mat-icon *ngIf="isUpgrading" class="spinning">sync</mat-icon>
              <span>{{ isUpgrading ? 'Loading...' : 'Upgrade to Enterprise' }}</span>
            </button>
          </div>
        </div>

        <!-- Manage Subscription (Paid tiers) -->
        <div class="manage-subscription" *ngIf="tierInfo.currentTier !== 'free'">
          <button
            class="action-button secondary"
            (click)="manageSubscription()">
            <mat-icon>settings</mat-icon>
            <span>Manage Subscription</span>
          </button>
          <p class="billing-note" *ngIf="(subscription$ | async)?.currentPeriodEnd as periodEnd">
            Next billing date: {{ periodEnd | date:'mediumDate' }}
          </p>
        </div>
      </div>
    </div>

    <!-- Preferences Section -->
    <div class="settings-section">
      <div class="section-header">
        <div class="section-icon">
          <mat-icon>tune</mat-icon>
        </div>
        <div class="section-title">
          <h2>Preferences</h2>
          <p>Customize your experience with MCP Everything</p>
        </div>
      </div>

      <div class="section-content">
        <div class="preferences-list">
          <div class="preference-item">
            <div class="preference-info">
              <div class="preference-label">Email Notifications</div>
              <div class="preference-description">Receive updates about your MCP servers and important announcements</div>
            </div>
            <div class="preference-control">
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  [(ngModel)]="settings.emailNotifications"
                  (change)="saveSettings()">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="preference-item">
            <div class="preference-info">
              <div class="preference-label">Auto-save Conversations</div>
              <div class="preference-description">Automatically save your chat history for future reference</div>
            </div>
            <div class="preference-control">
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  [(ngModel)]="settings.autoSave"
                  (change)="saveSettings()">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="preference-item disabled">
            <div class="preference-info">
              <div class="preference-label">Dark Mode</div>
              <div class="preference-description">Use a dark color scheme (coming soon)</div>
            </div>
            <div class="preference-control">
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  [(ngModel)]="settings.darkMode"
                  disabled>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Danger Zone -->
    <div class="settings-section danger-section">
      <div class="section-header">
        <div class="section-icon danger">
          <mat-icon>warning</mat-icon>
        </div>
        <div class="section-title">
          <h2>Danger Zone</h2>
          <p>Irreversible actions that permanently affect your account</p>
        </div>
      </div>

      <div class="section-content">
        <div class="danger-content">
          <p class="danger-warning">
            Once you delete your account, there is no going back. All your generated MCP servers,
            conversation history, and account data will be permanently removed from our systems.
          </p>

          <div class="form-actions">
            <button
              class="action-button danger"
              (click)="deleteAccount()">
              <mat-icon>delete_forever</mat-icon>
              <span>Delete Account</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
